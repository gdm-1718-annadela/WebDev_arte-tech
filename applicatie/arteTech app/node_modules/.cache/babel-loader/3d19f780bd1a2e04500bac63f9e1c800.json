{"ast":null,"code":"import _slicedToArray from \"/Users/annadelanghe/Documents/school/CMSDev/Eindwerk1920/applicatie/arteTech app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/annadelanghe/Documents/school/CMSDev/Eindwerk1920/applicatie/arteTech app/src/views/Login.jsx\";\nimport React, { useState, useEffect, Component } from 'react';\nimport { BrowserRouter as Router, Switch, Route, Link, Redirect } from \"react-router-dom\";\nimport './../css/general.css';\nimport './../css/login.css';\nexport default function Login() {\n  const _useState = useState(\"\"),\n        _useState2 = _slicedToArray(_useState, 2),\n        userName = _useState2[0],\n        setUserName = _useState2[1];\n\n  const _useState3 = useState(\"\"),\n        _useState4 = _slicedToArray(_useState3, 2),\n        userPassword = _useState4[0],\n        setPassword = _useState4[1];\n\n  const token = localStorage.getItem('token');\n  const role = localStorage.getItem('role');\n\n  const handleSubmit = () => {\n    console.log(userName);\n    console.log(userPassword);\n    const encodedString = new Buffer(userName + ':' + userPassword).toString('base64');\n    console.log(encodedString);\n    fetch(\"http://localhost:8888/web/jwt/token\", {\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/vnd.api+json',\n        'Accept': 'application/x-www-form-urlencoded',\n        'Authorization': 'Basic ' + encodedString\n      }\n    }).then(response => {\n      return response.json();\n    }).then(data => {\n      console.log(data.token);\n      localStorage.setItem('token', data.token);\n      fetch('http://localhost:8888/web/jsonapi', {\n        method: \"GET\",\n        headers: {\n          'Content-Type': 'application/vnd.api+json',\n          'Accept': 'application/x-www-form-urlencoded',\n          'Authorization': 'Bearer ' + data.token\n        }\n      }).then(response => {\n        return response.json();\n      }).then(getuser => {\n        const userid = getuser.meta.links.me.meta.id;\n        localStorage.setItem('userId', userid); // window.location.reload(false);\n\n        window.location.replace(\"/\");\n      });\n    });\n  };\n\n  function getUserId() {\n    const userId = localStorage.getItem('userId');\n    fetch(\"http://localhost:8888/web/jsonapi/user/user/\" + userId + \"/?include=roles\", {\n      method: \"GET\",\n      headers: {\n        'Content-Type': 'application/vnd.api+json',\n        'Accept': 'application/x-www-form-urlencoded',\n        'Authorization': 'Bearer ' + token\n      }\n    }).then(response => {\n      return response.json();\n    }).then(data => {\n      try {\n        const role = data.included[0].attributes.label;\n        localStorage.setItem('role', role);\n      } catch {\n        return React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 74\n          },\n          __self: this\n        }, \"no!\");\n      }\n    });\n  }\n\n  let options = [];\n\n  function getClients() {\n    fetch('http://localhost:8888/web/jsonapi/user/user', {\n      method: \"GET\",\n      headers: {\n        'Content-Type': 'application/vnd.api+json',\n        'Accept': 'application/x-www-form-urlencoded',\n        'Authorization': 'Bearer ' + token\n      }\n    }).then(response => {\n      return response.json();\n    }).then(data => {\n      for (let i = 0; i < data.data.length; i++) {\n        let roles = data.data[i].relationships;\n\n        if (roles) {\n          let rolesId = roles.roles.data[0].id;\n\n          if (rolesId == \"5cf72a3c-f224-4234-aad8-0bb78c1c56cc\") {\n            let nameClient = data.data[i].attributes.name;\n            options.push(nameClient);\n          }\n        }\n\n        localStorage.setItem('clients', JSON.stringify(options));\n      }\n    });\n  }\n\n  function checkAgain() {\n    if (role == \"medewerker\" || role == \"Administrator\") {\n      window.location.replace(\"/\");\n    }\n  }\n\n  if (token && !role) {\n    getUserId();\n    checkAgain(); // getClients()\n\n    return React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, \"Welkome\");\n  }\n\n  if (role == \"medewerker\" || role == \"Administrator\") {\n    window.location.replace(\"/\");\n  } else {\n    return React.createElement(\"div\", {\n      className: \"body boxshadow\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      className: \"title loginTitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, \"Login\"), React.createElement(\"div\", {\n      className: \"loginFormulier\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      className: \"loginlabel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, \"Gebruikersnaam\"), React.createElement(\"input\", {\n      className: \"input loginInput\",\n      name: \"username\",\n      type: \"text\",\n      onChange: e => setUserName(e.target.value),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }), React.createElement(\"label\", {\n      className: \"loginlabel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, \"Wachtwoord\"), React.createElement(\"input\", {\n      className: \"input loginInput\",\n      name: \"password\",\n      type: \"password\",\n      onChange: e => setPassword(e.target.value),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }), React.createElement(\"button\", {\n      className: \"btnColor btnLogin boxshadow\",\n      onClick: handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, \"Login\")));\n  }\n}","map":{"version":3,"sources":["/Users/annadelanghe/Documents/school/CMSDev/Eindwerk1920/applicatie/arteTech app/src/views/Login.jsx"],"names":["React","useState","useEffect","Component","BrowserRouter","Router","Switch","Route","Link","Redirect","Login","userName","setUserName","userPassword","setPassword","token","localStorage","getItem","role","handleSubmit","console","log","encodedString","Buffer","toString","fetch","method","headers","then","response","json","data","setItem","getuser","userid","meta","links","me","id","window","location","replace","getUserId","userId","included","attributes","label","options","getClients","i","length","roles","relationships","rolesId","nameClient","name","push","JSON","stringify","checkAgain","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Component } from 'react';\r\n\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route,\r\n  Link,\r\n  Redirect\r\n} from \"react-router-dom\";\r\n\r\nimport './../css/general.css'\r\nimport './../css/login.css'\r\n\r\n\r\nexport default function Login () {\r\n  const [userName, setUserName] = useState(\"\")\r\n  const [userPassword, setPassword] = useState(\"\")\r\n  const token = localStorage.getItem('token')\r\n  const role = localStorage.getItem('role')\r\n\r\n  const handleSubmit = () => {\r\n    console.log(userName);\r\n    console.log(userPassword);\r\n    const encodedString = new Buffer(userName + ':' + userPassword).toString('base64')\r\n    console.log(encodedString);\r\n    fetch(\"http://localhost:8888/web/jwt/token\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        'Content-Type': 'application/vnd.api+json',\r\n        'Accept': 'application/x-www-form-urlencoded',\r\n        'Authorization': 'Basic ' + encodedString\r\n      },\r\n    }).then((response) => {\r\n      return response.json();\r\n    }).then((data)=> {\r\n      console.log(data.token)\r\n      localStorage.setItem('token', data.token)\r\n      fetch('http://localhost:8888/web/jsonapi',{\r\n        method: \"GET\",\r\n        headers: {\r\n          'Content-Type': 'application/vnd.api+json',\r\n          'Accept': 'application/x-www-form-urlencoded',\r\n          'Authorization': 'Bearer ' +  data.token\r\n        },\r\n      }).then((response) => {\r\n        return response.json();\r\n      }).then((getuser)=> {\r\n        const userid = getuser.meta.links.me.meta.id\r\n        localStorage.setItem('userId', userid) \r\n        // window.location.reload(false);\r\n        window.location.replace(\"/\");\r\n\r\n      })\r\n    })\r\n  }\r\n\r\n  function getUserId(){\r\n    const userId = localStorage.getItem('userId') \r\n    fetch(\"http://localhost:8888/web/jsonapi/user/user/\" + userId + \"/?include=roles\", {\r\n      method: \"GET\",\r\n      headers: {\r\n        'Content-Type': 'application/vnd.api+json',\r\n        'Accept': 'application/x-www-form-urlencoded',\r\n        'Authorization': 'Bearer ' + token\r\n      },\r\n    }).then((response) => {\r\n      return response.json();\r\n    }).then((data)=> {\r\n      try {\r\n        const role = data.included[0].attributes.label\r\n        localStorage.setItem('role', role)\r\n      }\r\n      catch {\r\n        return(<h1>no!</h1>)\r\n      }\r\n    })\r\n  }\r\n\r\n  let options = []\r\n\r\n  function getClients (){\r\n    fetch('http://localhost:8888/web/jsonapi/user/user', {\r\n      method: \"GET\",\r\n      headers: {\r\n        'Content-Type': 'application/vnd.api+json',\r\n        'Accept': 'application/x-www-form-urlencoded',\r\n        'Authorization': 'Bearer ' +  token\r\n      },\r\n    }).then((response) => {\r\n      return response.json();\r\n    }).then((data)=> {\r\n      for(let i = 0; i < data.data.length ; i++){\r\n        let roles = data.data[i].relationships\r\n        if (roles){\r\n          let rolesId = roles.roles.data[0].id\r\n          if (rolesId == \"5cf72a3c-f224-4234-aad8-0bb78c1c56cc\"){\r\n            let nameClient = data.data[i].attributes.name\r\n            options.push(nameClient)\r\n          }\r\n        }\r\n        localStorage.setItem('clients', JSON.stringify(options))\r\n      }\r\n    })\r\n  }\r\n\r\n \r\n  function checkAgain(){\r\n    if(role == \"medewerker\" || role == \"Administrator\"){\r\n      window.location.replace(\"/\")\r\n  } \r\n  }\r\n\r\n\r\n  if(token && !role){\r\n    getUserId()\r\n    checkAgain()\r\n    // getClients()\r\n    return(<h1>Welkome</h1>)\r\n  } \r\n   if(role == \"medewerker\" || role == \"Administrator\"){\r\n      window.location.replace(\"/\")\r\n  } \r\n  else {\r\n    return(\r\n      <div className=\"body boxshadow\">\r\n        <h1 className=\"title loginTitle\">Login</h1>\r\n        <div className=\"loginFormulier\">\r\n          <label className=\"loginlabel\">Gebruikersnaam</label>\r\n          <input\r\n            className=\"input loginInput\"\r\n            name=\"username\"\r\n            type=\"text\"\r\n            onChange={(e) => setUserName(e.target.value)}\r\n          />\r\n          <label className=\"loginlabel\">Wachtwoord</label>\r\n          <input\r\n            className=\"input loginInput\"\r\n            name=\"password\"\r\n            type=\"password\"\r\n            onChange={(e) => setPassword(e.target.value)} \r\n          />\r\n          <button className=\"btnColor btnLogin boxshadow\"onClick={handleSubmit}>Login</button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}